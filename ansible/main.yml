---
# Nombre: ansible_configure_webserver.yml
# Playbook Ansible para configurar un servidor web (Nginx)

- hosts: webservers # Este es un grupo de hosts que deberías definir en tu inventario Ansible
  become: true # Permite ejecutar tareas con privilegios de root

  vars:
    webserver_package: nginx
    config_dir: /etc/nginx/sites-available
    enabled_dir: /etc/nginx/sites-enabled
    app_name: my_app_site # Nombre del sitio a configurar (ej. my_app_site)

  tasks:
    - name: Asegurar que el paquete del servidor web está instalado
      package:
        name: "{{ webserver_package }}"
        state: present
      when: ansible_os_family == "Debian" # Ejemplo para sistemas basados en Debian/Ubuntu

    - name: Copiar archivo de configuración del sitio web
      copy:
        src: files/nginx/{{ app_name }}.conf # Asegúrate de tener un archivo llamado 'my_app_site.conf' en 'files/nginx/'
        dest: "{{ config_dir }}/{{ app_name }}"
        owner: root
        group: root
        mode: '0644'
      notify:
        - Recargar Nginx

    - name: Habilitar el sitio web (crear enlace simbólico)
      file:
        src: "{{ config_dir }}/{{ app_name }}"
        dest: "{{ enabled_dir }}/{{ app_name }}"
        state: link
        force: yes # Sobreescribe si ya existe un enlace
      notify:
        - Recargar Nginx

    - name: Asegurar que el servicio Nginx esté iniciado y habilitado
      service:
        name: "{{ webserver_package }}"
        state: started
        enabled: yes

  handlers:
    - name: Recargar Nginx
      service:
        name: "{{ webserver_package }}"
        state: reloaded
---
# Nombre: terraform_aws_ec2_instance.tf
# Ejemplo 1: Creación de una instancia EC2 de Amazon Web Services con acceso SSH

provider "aws" {
  region = "us-east-1" # Reemplaza con tu región preferida
}

# Datos para obtener la AMI más reciente de Amazon Linux 2
data "aws_ami" "amazon_linux_2" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }

  filter {
    name   = "virtualization-type"
    values = ["hvm"]
  }
}

# Se asume que ya existe una VPC, subred y un grupo de seguridad.
# Aquí se usa un grupo de seguridad existente para simplificar.
data "aws_security_group" "existing_sg" {
  id = "sg-0abcdef1234567890" # ¡REEMPLAZA con el ID de tu grupo de seguridad existente!
}

resource "aws_instance" "web_server" {
  ami                    = data.aws_ami.amazon_linux_2.id
  instance_type          = "t2.micro"
  # Subred_id es necesaria si usas una VPC específica. Si no, puede omitirse para usar la VPC por defecto.
  # subnet_id            = "subnet-0123456789abcdef0" # ¡REEMPLAZA con tu ID de subred si es necesario!
  vpc_security_group_ids = [data.aws_security_group.existing_sg.id]
  key_name               = "my-ssh-key" # ¡REEMPLAZA con el nombre de tu par de claves SSH en AWS!

  tags = {
    Name        = "WebServerInstance"
    Environment = "Development"
  }
}

output "ec2_instance_public_ip" {
  description = "La dirección IP pública de la instancia EC2."
  value       = aws_instance.web_server.public_ip
}

output "ec2_instance_private_ip" {
  description = "La dirección IP privada de la instancia EC2."
  value       = aws_instance.web_server.private_ip
}

# Nombre: terraform_azure_storage_account.tf
# Ejemplo 2: Creación de una cuenta de almacenamiento en Azure

provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "storage_rg" {
  name     = "rg-storage-tf-example"
  location = "East US" # Reemplaza con tu región preferida
}

resource "azurerm_storage_account" "sa" {
  name                     = "stexampletf${random_string.suffix.result}" # Nombre único globalmente
  resource_group_name      = azurerm_resource_group.storage_rg.name
  location                 = azurerm_resource_group.storage_rg.location
  account_tier             = "Standard_LRS"
  account_replication_type = "LRS" # Locally-redundant storage

  tags = {
    environment = "TerraformExample"
  }
}

resource "random_string" "suffix" {
  length  = 6
  special = false
  upper   = false
}

output "storage_account_name" {
  description = "El nombre de la cuenta de almacenamiento de Azure."
  value       = azurerm_storage_account.sa.name
}

output "storage_account_primary_access_key" {
  description = "La clave de acceso primaria de la cuenta de almacenamiento de Azure."
  value       = azurerm_storage_account.sa.primary_access_key
  sensitive   = true # Marca como sensible ya que es una clave de acceso
}
