```yaml
---
# Nombre: ansible_deploy_web_app.yml
# Playbook Ansible para desplegar una aplicación web simple, descargarla y configurar Nginx

- hosts: web_servers
  become: true # Ejecutar tareas con privilegios de root

  vars:
    app_repo_url: "https://github.com/ejemplo/mi-aplicacion-web.git" # URL del repositorio de la app
    app_dest_path: "/var/www/mi-aplicacion-web"
    app_service_name: nginx
    app_port: 80

  tasks:
    - name: Actualizar caché de apt
      apt:
        update_cache: yes
      when: ansible_os_family == "Debian"

    - name: Instalar Git y Nginx
      package:
        name: "{{ item }}"
        state: present
      loop:
        - git
        - nginx
      when: ansible_os_family == "Debian"

    - name: Clonar o actualizar el repositorio de la aplicación
      git:
        repo: "{{ app_repo_url }}"
        dest: "{{ app_dest_path }}"
        update: yes # Clona si no existe, o actualiza si ya existe

    - name: Configurar Nginx para servir la aplicación
      template:
        src: templates/nginx_app.conf.j2 # Necesitarás crear este archivo template en un subdirectorio 'templates'
        dest: "/etc/nginx/sites-available/mi-aplicacion-web"
      notify:
        - Recargar Nginx

    - name: Habilitar la configuración del sitio Nginx
      file:
        src: "/etc/nginx/sites-available/mi-aplicacion-web"
        dest: "/etc/nginx/sites-enabled/mi-aplicacion-web"
        state: link
      notify:
        - Recargar Nginx

    - name: Eliminar configuración por defecto de Nginx si existe (opcional)
      file:
        path: "/etc/nginx/sites-enabled/default"
        state: absent
      notify:
        - Recargar Nginx

    - name: Asegurar que Nginx esté iniciado y habilitado
      service:
        name: "{{ app_service_name }}"
        state: started
        enabled: yes

  handlers:
    - name: Recargar Nginx
      service:
        name: "{{ app_service_name }}"
        state: reloaded

---
# Nombre: ansible_install_docker.yml
# Playbook Ansible para instalar Docker Engine en sistemas basados en Debian y RedHat

- hosts: docker_hosts
  become: true

  tasks:
    - name: Agregar la clave GPG oficial de Docker
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present
      when: ansible_os_family == "Debian"
      # Nota: En sistemas RedHat, el método puede ser diferente (ej. bajar y ejecutar un script).
      # Este ejemplo se enfoca en Debian/Ubuntu para simplificar.

    - name: Agregar el repositorio APT de Docker
      apt_repository:
        repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable"
        state: present
        update_cache: yes
      when: ansible_os_family == "Debian"

    - name: Instalar Docker CE, CLI, Containerd y plugins (Debian/Ubuntu)
      apt:
        name:
          - docker-ce
          - docker-ce-cli
          - containerd.io
          - docker-buildx-plugin
          - docker-compose-plugin
        state: present
      when: ansible_os_family == "Debian"

    - name: Asegurar que Docker esté iniciado y habilitado
      service:
        name: docker
        state: started
        enabled: yes
```

```yaml
---
# Nombre: ansible_configure_database_user.yml
# Playbook Ansible para crear un usuario de base de datos PostgreSQL y otorgarle permisos

- hosts: db_servers
  become: true # Si se necesita acceso a binarios de PostgreSQL como superusuario

  vars:
    db_user: app_db_user
    db_password: "secure_password_for_app_user" # ¡IMPORTANTE! Considera usar Ansible Vault para esto.
    db_name: app_database
    pg_listen_addresses: "*" # Permite conexiones desde cualquier IP (¡restringir en producción!)

  tasks:
    - name: Instalar PostgreSQL (si no está instalado)
      package:
        name: "postgresql"
        state: present
      when: ansible_os_family == "Debian"

    # Nota: Para sistemas RedHat, el paquete y el servicio pueden ser 'postgresql-server' y 'postgresql'.

    - name: Asegurar que PostgreSQL esté iniciado y habilitado
      service:
        name: postgresql
        state: started
        enabled: yes

    - name: Configurar PostgreSQL para aceptar conexiones externas (pg_hba.conf)
      lineinfile:
        path: /etc/postgresql/{{ ansible_pkg_mgr_version }}/main/pg_hba.conf # Ajusta la ruta según tu versión/SO
        line: "host    {{ db_name }}    {{ db_user }}    0.0.0.0/0    md5"
        state: present
        backup: yes
      notify:
        - Reiniciar PostgreSQL

    - name: Configurar PostgreSQL para escuchar en todas las interfaces (postgresql.conf)
      lineinfile:
        path: /etc/postgresql/{{ ansible_pkg_mgr_version }}/main/postgresql.conf # Ajusta la ruta
        regexp: '^#?listen_addresses\s*='
        line: "listen_addresses = '{{ pg_listen_addresses }}'"
        state: present
        backup: yes
      notify:
        - Reiniciar PostgreSQL

    - name: Crear base de datos "{{ db_name }}" si no existe
      postgresql_db:
        name: "{{ db_name }}"
        state: present
        login_user: postgres # Asume que el usuario 'postgres' tiene acceso

    - name: Crear usuario de base de datos "{{ db_user }}" si no existe
      postgresql_user:
        name: "{{ db_user }}"
        password: "{{ db_password }}"
        state: present
        login_user: postgres
        priv: ALL # Otorgar todos los privilegios al usuario

    - name: Otorgar todos los privilegios en la base de datos "{{ db_name }}" al usuario "{{ db_user }}"
      postgresql_user:
        db_name: "{{ db_name }}"
        name: "{{ db_user }}"
        state: present
        login_user: postgres
        priv: ALL # Nuevamente, asegurar privilegios

  handlers:
    - name: Reiniciar PostgreSQL
      service:
        name: postgresql
        state: restarted
```