 ---
# Ansible Playbook: ansible_infrastructure.yml

This playbook configures three VMs and a PostgreSQL database for the international transfer project. It assumes SSH access is configured to the target VMs.

## Variables

```yaml
---
ansible_user: ubuntu
ansible_ssh_private_key_file: ~/.ssh/id_rsa
web_servers:
  - host: 192.168.1.101
  - host: 192.168.1.102
  - host: 192.168.1.103
database_server:
  host: 192.168.1.104
  user: db_user
  password: db_password
```

## Roles

### Database Role

```yaml
---
- name: Install and configure PostgreSQL
  hosts: "{{ database_server }}"
  become: yes
  roles:
    - postgresql
```

### PostgreSQL Role

```yaml
---
- name: Ensure PostgreSQL is installed
  apt:
    name: postgresql
    state: present

- name: Create database and user
  postgresql_db:
    name: "{{ item }}"
    state: present
    login_user: db_user
  loop:
    - international_transfer_db
```

### Web Servers Role

```yaml
---
- name: Install and configure Apache
  hosts: web_servers
  become: yes
  roles:
    - apache

- name: Ensure Apache modules are installed
  apt:
    name: "{{ item }}"
    state: present
  loop:
    - libapache2-mod-wsgi
    - python3
    - python3-pip
    - python3-dev
    - build-essential

- name: Install required packages for web application
  pip:
    package: "{{ item }}"
  loop:
    - gunicorn
    - boto3
```