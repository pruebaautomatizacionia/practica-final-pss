---
# Ansible Playbook para la configuración de la infraestructura

Este playbook Ansible configura tres VMs y una base de datos SQL para un proyecto de transferencia internacional.  Asume que ya tienes una conexión SSH configurada a las VMs.

## Variables

```yaml
# variables.yml
ansible_user: ubuntu
ansible_ssh_private_key_file: ~/.ssh/id_rsa
inventory:
  web1:
    host: 192.168.1.101
    ansible_connection: ssh
    ansible_user: ubuntu
  web2:
    host: 192.168.1.102
    ansible_connection: ssh
    ansible_user: ubuntu
  web3:
    host: 192.168.1.103
    ansible_connection: ssh
    ansible_user: ubuntu
database:
  host: 192.168.1.200
  port: 5432
  user: db_user
  password: db_password
  name: international_transfer_db
```

## Playbook Ansible: infrastructure_setup.yml

```yaml
---
- name: Configure Infrastructure
  hosts: all
  become: true
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
      when: ansible_distribution == "Ubuntu"

    - name: Install common packages
      apt:
        name:
          - python3
          - python3-pip
          - git
          - vim
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Install PostgreSQL
      apt:
        name: postgresql
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Create database
      postgresql_db:
        name: "{{ database.name }}"
        owner: postgres
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Create PostgreSQL user
      postgresql_user:
        name: "{{ database.user }}"
        password: "{{ database.password }}"
        priv: ALL
        state: present
        role: postgres
      when: ansible_distribution == "Ubuntu"

    - name: Configure PostgreSQL
      postgresql_setup:
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Install Nginx
      apt:
        name: nginx
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Start and enable Nginx
      service:
        name: nginx
        state: started
        enabled: yes
      when: ansible_distribution == "Ubuntu"

    - name: Install Apache
      apt:
        name: apache2
        state: present
      when: ansible_distribution == "Ubuntu"

    - name: Start and enable Apache
      service:
        name: apache2
        state: started
        enabled: yes
      when: ansible_distribution == "Ubuntu"
```

## Playbook Ansible: web_server_config.yml

```yaml
---
- name: Configure Web Servers
  hosts: web1,web2,web3
  become: true
  tasks:
    - name: Copy web server configuration
      copy:
        src: files/nginx.conf
        dest: /etc/nginx/sites-available/default
      notify:
        - restart nginx

    - name: Enable default Nginx site
      file:
        src: /etc/nginx/sites-available/default
        dest: /etc/nginx/sites-enabled/default
        state: link
      notify:
        - restart nginx

    - name: Copy Apache web configuration
      copy:
        src: files/apache2.conf
        dest: /etc/apache2/sites-available/000-default.conf
      notify:
        - restart apache2

    - name: Enable default Apache site
      file:
        src: /etc/apache2/sites-available/000-default.conf
        dest: /etc/apache2/sites-enabled/000-default.conf
        state: link
      notify:
        - restart apache2
```

## Handler Ansible

```yaml
# handlers.yml
handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted

  - name: restart apache2
    service:
      name: apache2
      state: restarted
```

## Files (Ejemplos - deben crearse en el mismo directorio que el playbook)

*   **files/nginx.conf:**  Contiene la configuración de Nginx.
*   **files/apache2.conf:** Contiene la configuración de Apache.

**Nota:**  Los archivos `nginx.conf` y `apache2.conf` deben ser creados y adaptados a las necesidades específicas del proyecto.  Este playbook proporciona una configuración básica.
